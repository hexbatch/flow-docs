# 0.6 changes bring up entries to be fully usable

at the end of this, can fully organize ideas in 2d

## 0.6.1 Goodbye Attribute Pointers

Small but needed

Earlier, was not sure what roles to give these applied and attributes. But now, attributes hold standards and data, and applied links stuff: two well-defined roles. The attributes of points_to is only used in one place now

* Add a tagged_flow_tag_id to applied
* move the settings over to be held there instead of the applied points_to_tag_id
* Remove points_to_entry_id ,points_to_user_id ,points_to_project_id ,points_to_tag_id from attributes
* update the gui to not show links to the applied
* add tag link display for applied (what it points too, and its name)



## 0.6.2 Selections

This will increase the ability for substituting in, and manipulation of tagged bb code in the entries

CSS like selectors for manipulating entries. CSS normally has three things, classes, ids and tag `a#idea.has.been.made b.great`

* **ids** are the names (or guids) of the entries
    * (note: when entry name changes need to find entry name in existing selections and change that to keep current)
* **classes** are the names of the tags, so very possible to have sibling and parent child relationships with tags attached to entries as they are embedded in the dom
* **tags** are the bb code tags. This way possible to grab only images, for example from sections
* **pseudo classes** are the tag standards, will match if the selection has one tag that has this standard
* **indirect links** sometimes we want to select based on where the entry is on the web of connections (connected to A and B), or even (connected to A via C connect three times to B), (or select what B points to)

Will use embedded lua functions to combine and search as needed. I wanted xpath or css rules, but realized later I needed a callback for each in the rule string, and finding a ready made parser in php was problematic. Also, looking back, such an approach would be harder to implement and honestly provide some restrictions in search (because I will do rules for indirectness between both tags and entries not covered)


Lua sandbox is supposed to run on 8.1
* https://www.php.net/book.luasandbox
* https://www.mediawiki.org/wiki/LuaSandbox
* https://www.lua.org/ftp/lua-5.1.5.tar.gz 
* https://www.lua.org/manual/5.1/  (and ordered paper book)

In the php 

* Each lua callback will return a found array of strings, representing sets found.
* These strings are guids that match keys holding the values to use in php.
* The php embedded functions will accept a string or string array of either a new query or one of the guids from a previous query and will always return an array
* If more than one selection guid in an array, passed to a function, these are always treated as unions

In the lua

* The lua will be able to select one or more things from any rules as a selection to use 
* The lua can use any number of selections, at any point in its program and they can be sources or targets or both
* Any set of selections already made, can be filtered again to make other selections from them
* At any point, any selection can be a source, to lift the content from, or a target to apply the content too, or both  
* If applying a source to itself as target, this will raise an exception that can be handled in lua.
* If duplicates in the arrays
* The php will be building this as the lua progresses, and when the lua ends will send the resulting bb code to be converted to html  

There will be a new api function that allows sending in lua to a project to do the above, It will always return html


## 0.6.3 Bookmarks

When viewing an entry there should be bookmarks around it that go to other entries or selections (so can link whole entries or see a view when clicking, and those have links too)

Each bookmark uses a selection from 0.6.2, if the selection is just for the #next-entry then the whole entry will be displayed, however can be any selection

A bookmark is simply a tag , created just to be that. It is applied directly to the entry or view in its tagged_flow_entry_id. Its appearance and position is determined by the standards in it. The tag links from the source entry. The xpath of the tag can define a whole entry or a view

When the bookmark is clicked, it generates the view from the xpath. This view is returned via the api, so the web page can open a new tab or simply add the content to the same page

the view generated by the bookmark can also have its own bookmarks too ! Since this is a tag, the bookmarks links from that tag, and not an entry

bookmarks are defined by having the standard of "bookmark"

The bookmark has some properties:
position to show on the page around the entry or view
the title of the link
the xpath (the actual attribute that holds the xpath is always called xpath-value)
maybe some more..

The tag is colored by the tags css standard

When clicking on a bookmark, popup with two tabs show up. The first is the edit pane for the bookmark standard, the second tab is the edit pane for the css standard

Create a new api endpoints for adding, editing and deleting bookmark

Show the bookmarks in the gui when the entry or view is shown. Clicking on the bookmark

Internal changes:

Selections are now saved to be part of tags. However,  entry names, and tag names, can be changed and that breaks selection rules using it unless those are replaced. So need an easy way to find and replace , or mark as invalid based on name changes or deletions.
There are lots of ways to replace these names. Lots of ways take too much time and require including other libraries that may or may not take a lot of time to work! So, no fancy parsing of the xpath. Instead, xpath stored as plain text in the attribute

Then
* simply to dis-allow entry, project and tag, and standard names from having words used in the xpath, looking at https://www.w3.org/TR/xpath-30/#id-reserved-fn-names and A.4 Precedence Order under that should give the list. Also see https://www.w3schools.com/xml/xpath_operators.asp . Also while right now no two tags or two entries can have the same name or title, change this to be that once a tag name or entry title is used, no other tag or entry can use it. standards are prefixed with their own namespace in the xpath so can be same.
* when name changes do simple text replacement (using regex for word boundaries)
* when tag or entry deleted, find the xpaths and mark them as invalid (tag given attribute to show xpath is invalid)

## 0.6.4 Edit Views

When seeing a view, can edit parts of it in the bb editor and save the original.
* Entering an editing mode for a view, the different tag source areas are shown in different subtle color hints
* Clicking on something to edit that is colorized will open a bb editor in place 
* Saving the changes will update that part of the document it is from
* If any other views are using that part, they will be updated too

## 0.6.5 Web of things

Make a new web control and api to navigate through the connections of bookmarks.

For now, use the dot library from other project to draw graph.
Two views:
* First view, "click and see"
    * An entry can now be marked as an initial place to visit. When that is clicked expand on its dots and only its dots
    * Allow back button to go back
* Second view, "show everything"
    * Make a graph of all connections, when select a dot, zoom in , show more detail. Can zoom out again and pan

in both, can show the entry or view, either in a new tab, or somehow displayed along with the dots


## 0.6.6 Resources

Adds entry level resources and easy insertion and use (pictures, movies, pdf, etc). These are stored in the entry folders so can be moved around to different projects better

A unicode, and emoticon picker for easy adding to entries, there is a favorite bar too, that allows picking commonly used things faster

Add the file upload plugin for the bb editor

Add ability to add pre-defined short tags directly into the entry code. These short-tags are a new tag standard 

the short-tags can include an api point, method call type, and params. Will use this to make an admin screen from entry




# 0.7 changes make this app deployable and more approachable 

## 0.7.0 Whitelist

Create new tag standard of list.
* The editor gui for the list allows adding and removing things in a text area, each line will be that one list item
* The project settings can have a new hint in the constants to return the list contents as an array, or set from array 

Change user signup to read from a list of pre-accepted emails, and remove that from list once sign up is done
This removes span once site is public

## 0.7.1 K8s

Use K8 to create containers instead of docker composer 





Change logging to go to unix pipe, and a tail reader too 
* https://pracucci.com/php-on-kubernetes-application-logging-via-unix-pipe.html
* 
Add an elk stack, to show decent logging
* https://www.elastic.co/what-is/elk-stack
* https://www.elastic.co/guide/en/elastic-stack-get-started/current/get-started-stack-docker.html
* https://github.com/elastic/helm-charts
* https://logz.io/blog/deploying-the-elk-stack-on-kubernetes-with-helm/
* maybe https://www.middlewareinventory.com/blog/kubernetes-sidecar-logging-with-fluentd-to-efk/

scale fpm better
* https://github.com/hipages/php-fpm_exporter
* https://blog.wyrihaximus.net/2021/01/scaling-php-fpm-based-on-utilization-demand-on-kubernetes/

Node and composer there too in their own sidecars (init processes ?)


## 0.7.2 Deploy to website !!!

Use vault for secrets

Have working db backups again (they work now but will change here)

Have working volume backups (again, this changes here so need to redo that )

Have option to deploy using saved version of db, version volumes (pull in data for volumes), and commit hash for code

Have way for viewing project volumes

Have admin tools for doing db migrations and trigger refreshes

Configure db to be accessed in a good way here

There will be changes, but will not know what now, to accommodate the deployment pipeline 

## 0.7.3 Internationalization

No more bare-word english in the displayed words on all pages ! Use pot files

Set up a good way to have workflow with pot files

## 0.7.4 Real API

Expose all functionality using an api, that logs in using basic auth (can add other ways later)

This will be v1

Add swagger documentation, built from doc blocks in v1 

## 0.7.5 Testing Suit

Start Unit tests with phpunit , and Api Testing using tests automated from the swagger


## 0.7.6 Update Docs

Have usage docs for the pages that go with the swagger docs. 



